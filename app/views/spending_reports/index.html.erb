<div class="max-w-6xl mx-auto py-10 px-4">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Civic Spending Search</h1>
    <%= link_to "Refresh Data", ingestion_fetch_path, data: { turbo_method: :post }, class: "text-sm text-indigo-600 hover:text-indigo-800" if Rails.env.development? %>
  </div>

  <!-- Search Form -->
  <div class="mb-8" data-controller="search">
    <%= form_with url: spending_reports_path, method: :get, 
                  data: { 
                    action: "input->search#submit",
                    turbo_frame: "spending_results" 
                  } do |f| %>
      <div class="relative">
        <%= f.text_field :q, value: @query, 
            placeholder: "Search by keyword or concept (e.g., 'school repairs' or 'infrastructure')...", 
            class: "w-full p-4 pl-12 rounded-lg border border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-lg" %>
        <div class="absolute left-4 top-4 text-gray-400">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Turbo Frame Results -->
  <!-- The frame tag is now inside the partial to ensure it persists during updates -->
  <%= render "reports_list", reports: @reports, pagy: @pagy %>
</div>